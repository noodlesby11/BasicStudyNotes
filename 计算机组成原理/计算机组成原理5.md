# 中央处理器CPU

----

## CPU的功能和组成

### CPU的功能

**指令控制：**程序的顺序控制，称为指令控制。

**操作控制：**CPU管理并产生内存取出的每条指令的操作信号，把操作信号送往各个部件，从而实现对各个部件的控制。

**时间控制 ：**对各种操作实施时间上的定时。

**数据加工：**对数据进行算数运算和逻辑运算处理。

### CPU的组成

**控制器：**由程序计数器（PC）、指令寄存器（IR）、指令译码器、时序发生器和操作控制器（OC）组成，功能：

* 从指令cache中取出一条指令，并指出下一条指令的位置

* 对指令进行译码或测试，产生相应的操作控制信号，以启动规定的动作。

* 指挥并控制CPU、数据cache和输入/输出设备之间数据流动的方向

**运算器：**算术逻辑运算单元：ALU ，通用寄存器：R0～R3 ，数据缓冲寄存器：DR ，状态条件寄存器：PSWR组成，功能：

* 执行所有算术运算
* 执行所有逻辑运算并进行逻辑测试

### CPU的主要寄存器

**数据缓冲寄存器(DR)：**

用来暂时存放ALU的运算结果

* 作为ALU运算结果和通用寄存器之间信息传送中时间上的缓冲
* 补偿CPU和内存、外围设备之间在操作速度上的差异

**指令寄存器(IR)：**

用来存放当前正在执行的一条指令

**程序计数器(PC)：**

==存放下一条指令的地址==。 程序开始执行前，把起始地址送入PC，顺序执行时，每执行一条指令，PC的值应加1，要改变程序执行顺序的情况时，一般由转移类指令将转移目标地址送往PC ，可实现程序的转移。

**数据地址寄存器(AR)：**

用来保存当前CPU所访问的==数存单元的地址==

**通用寄存器(R0～R3) ：**

* 当前ALU执行算术运算或逻辑运算时，为其提供一个工作区。 

* 存放操作数和结果

* 还用作地址指示器、变址寄存器、堆栈指示器

* 对寄存器号加以编址

**状态字寄存器(PSWR)：**

保存由算术运算指令和逻辑运算指令或测试结果建立的各种条件代码，如进位标志（C），结果溢出标志（V）、运算结果为零标志（Z），运算结果为负标志（N）。

## 指令周期

### 指令周期的概念

**指令周期：**取出一条指令并执行这条指令的时间。

==指令周期往往由几个CPU周期（机器周期）表示==

**CUP周期：**用内存中读取一个指令字的最短时间

==一个CPU周期中，包含若干个时钟周期==

**时钟周期：**时钟周期是计算机中最基本的、最小的时间单位。通常定义为机器主频的倒数，在一个时钟周期内，CPU仅完成一个最基本的动作

**单周期CPU：**一个时钟周期内完成从指令取出到得到结果的所有操作。 

**多周期CPU：**指令的执行分成多个执行阶段，每个阶段在一个时钟周期内完成。不同指令所用周期数可以不同。

### 常见指令的指令周期

#### MOV指令

>101 mov r0,r1 表示将r1中的数据传送到r0中，共需要两个CPU周期

**取指周期：**

1. PC装入指令地址101（8进制）；
2. PC的内容放到ABUS上对指存进行译码，并启动读命令
3. 从101号地址读出MOV指令通过IBUS（指令总线）装入指令寄存器IR
4. PC＋１
5. IR中的操作码OP被译码
6. CPU识别出是MOV指令

**执行周期：**

1. 操作控制器OC送出控制信号到通用寄存器，选择R1作源寄存器，R0作目标寄存器
2. OC送出控制信号到ALU，指定ALU做出传送动作
3. OC送出控制信号，打开ALU输出三态门，将ALU输出到DBUS
4. OC送出控制信号，将DBUS数据送人数据寄存器DR中
5. OC送出控制信号，将DR中的数据送入R0

==R1–>ALU->DBUS->DR->R0==

#### LAD指令

>102 LAD R1，6     将6号单元取数送到R1中

**取指周期：**与MOV指令相同，不在介绍

**执行周期：**

1. OC送出控制信号，打开IR的三态门，将指令中的直接地址6放到DBUS
2. OC送出控制信号，将地址码6装入AR
3. OC送出控制信号，将数存中6号单元地址中的数据100放到DBUS
4. OC送出控制信号，将DBUS的数据放入DR
5. OC送出控制信号，将DR中的数据100送入R1

==IR->AR->DBUS->DR->R1==

#### ADD指令

>ADD R1,R2 执行R1+R2–>R2

**执行周期：**

1. OC送出控制信号到通用寄存器，选择R1做源寄存器，R2做目标寄存器
2. OC送出控制信号到ALU，指定ALU做加法操作
3. OC送出控制信号，指定ALU将运算结果120放到DBUS上
4. OC送出控制信号，将DBUS的数据打入DR中；ALU产生进位信号保存在状态字寄存器PSWR中
5. OC送出控制信号，将DR中的数据装入R2

#### STO指令

>STO R2,(R3)  将R2中的数据写入以R3为地址的数存中

**执行周期：**

1. OC送出控制信号，打开通用寄存器三态门，将R3的数据放到DBUS
2. OC送出控制信号，DBUS打到AR中
3. OC送出控制信号到通用寄存器，选择R2
4. OC送出控制信号打开通用寄存器三态门，将R2数据放到DBUS上
5. OC送出控制信号将数据写入以AR为地址的数存中

==R3–>DBUS–>AR R2–>DBUS->数存==

#### JMP指令

>JMP 101    跳转到101号指令

**执行周期：**

1. OC送出控制信号，打开IR三态门，将地址101放到DBUS
2. OC送出控制信号将DBUS的数据101打入PC中

==IR–>DBUS–>PC==

### 使用方框语言表示指令周期

* 方框：一个CPU周期

* 方框内内容：数据通路操作或控制操作

* 菱形符号：判别或测试

* ~：公操作

## 时序产生器和控制方式

### 时序信号的体制

**时序信号的概念：**计算机的协调动作需要时间标志，时间标志由时序信号来体现，用来确定时段执行哪些微操作；控制器发出的各自控制信号都是时间因素（时序信号）和空间因素（部件位

置）的函数；时序信号的最基本体制是==电位－脉冲制==

**时序信号的作用：**CPU中的控制器用它指挥机器的工作CPU可以用时序信号/周期信息来==辨认==从内存中取出的是指令（取指）还是数据（执行）一个CPU周期中时钟脉冲对CPU的动作有严格的==约束==。

**时序信号的体制：**

组成计算机硬件的器件特性决定了时序信号的基本体制是==电位—脉冲制==；组合逻辑控制器或硬布线控制器中，时序信号往往采用==主状态周期-节拍电位-节拍脉冲三级体制==，主状态周期包含若干个节拍电位；一个节拍电位包含若干个节拍脉冲；一个节拍电位表示一个CPU周期时间

### 控制方式

**同步控制方式：**

*在任何情况下，已定的指令在执行时所需的机器周期数和时钟周期数都固定不变。*

**异步控制方式：**

*每条指令需要多长时间就占多长时间；每条指令的指令周期可由多少不等的机器周期数组成；控制器发出某一操作控制信号后，等待执行部件完成操作后发“回答”信号，再开始新的操作。*

**联合控制方式：**

*此为同步控制和异步控制相结合的方式。*

*大部分指令在固定的机器周期内完成；少数时间难以确定的操作采用异步方式。机器周期的节拍脉冲固定，但是各指令的机器周期数不固定（微程序控制器采用）*

## 微程序控制器

### 微程序控制原理

#### 微命令与微操作

**微命令**是控制计算机各部件完成某个基本微操作的命令

**微操作**是执行部件接受微命令后所进行的操作

==微命令和微操作是一一对应的==

**互斥的微操作**是指==不能==同时或不能在同一个节拍内==并行执行==的微操作；反之称为**相容的微操作**

#### 微指令与微程序

**微指令**：把在同一CPU周期内并行执行的微操作控制信息，存储在控制存储器里，微指令是==微命令==的组合。一条微指令通常至少包含两大部分信息：==操作控制字段==和==顺序控制字段==

**操作控制字段（微操作码字段）：**用以产生某一步操作所需的各个微操作控制信号，某位为1，表示发出微命令，一般都是节拍电位信号，持续时间为一个CPU周期

**顺序控制字段（微地址码字段）：**用以决定产生下一条微指令的地址

* 

* 

* 

#### CPU 周期与微指令周期的关系

**微指令周期** = 读出微指令的时间 + 执行该条微指令的时间

==一般将一个微指令周期时间设计得和一个CPU周期时间相等==

#### 机器指令与微指令的关系

**一条机器**指令对应一个微程序

==一条机器指令的功能是由若干条微指令组成的序列来实现的==

### 微程序设计技术

编码方法有：直接表示法、编码表示法、混合表示法

微地址形成方法：计数器方法、多路转移法

微指令格式：垂直型微指令、水平型微指令